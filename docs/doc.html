<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0070)https://www.fit.vutbr.cz/study/courses/IIS/private/projekt/doc.html.cs -->
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>Projekt IIS</title>
	<style type="text/css">
		table {
			border-collapse: collapse;
		}

		td,
		th {
			border: 1px solid black;
			padding: 0.3em 0.5em;
			text-align: left;
		}

		dt {
			font-weight: bold;
			margin-top: 0.5em;
		}
	</style>
	<style>
		._3emE9--dark-theme .-S-tR--ff-downloader {
			background: rgba(30, 30, 30, .93);
			border: 1px solid rgba(82, 82, 82, .54);
			box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
			color: #fff
		}

		._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn {
			background: #3d4b52
		}

		._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover {
			background: #131415
		}

		._3emE9--dark-theme .-S-tR--ff-downloader ._10vpG--footer {
			background: rgba(30, 30, 30, .93)
		}

		._2mDEx--white-theme .-S-tR--ff-downloader {
			background: #fff;
			border: 1px solid rgba(82, 82, 82, .54);
			box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
			color: #314c75
		}

		._2mDEx--white-theme .-S-tR--ff-downloader ._6_Mtt--header {
			font-weight: 700
		}

		._2mDEx--white-theme .-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice {
			border: 0;
			color: rgba(0, 0, 0, .88)
		}

		._2mDEx--white-theme .-S-tR--ff-downloader ._10vpG--footer {
			background: #fff
		}

		.-S-tR--ff-downloader {
			display: block;
			overflow: hidden;
			position: fixed;
			bottom: 20px;
			right: 7.1%;
			width: 330px;
			height: 180px;
			background: rgba(30, 30, 30, .93);
			border-radius: 2px;
			color: #fff;
			z-index: 99999999;
			border: 1px solid rgba(82, 82, 82, .54);
			box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
			transition: .5s
		}

		.-S-tR--ff-downloader._3M7UQ--minimize {
			height: 62px
		}

		.-S-tR--ff-downloader._3M7UQ--minimize .nxuu4--file-info,
		.-S-tR--ff-downloader._3M7UQ--minimize ._6_Mtt--header {
			display: none
		}

		.-S-tR--ff-downloader ._6_Mtt--header {
			padding: 10px;
			font-size: 17px;
			font-family: sans-serif
		}

		.-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn {
			float: right;
			background: #f1ecec;
			height: 20px;
			width: 20px;
			text-align: center;
			padding: 2px;
			margin-top: -10px;
			cursor: pointer
		}

		.-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover {
			background: #e2dede
		}

		.-S-tR--ff-downloader ._13XQ2--error {
			color: red;
			padding: 10px;
			font-size: 12px;
			line-height: 19px
		}

		.-S-tR--ff-downloader ._2dFLA--container {
			position: relative;
			height: 100%
		}

		.-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info {
			padding: 6px 15px 0;
			font-family: sans-serif
		}

		.-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info div {
			margin-bottom: 5px;
			width: 100%;
			overflow: hidden
		}

		.-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice {
			margin-top: 21px;
			font-size: 11px
		}

		.-S-tR--ff-downloader ._10vpG--footer {
			width: 100%;
			bottom: 0;
			position: absolute;
			font-weight: 700
		}

		.-S-tR--ff-downloader ._10vpG--footer ._2V73d--loader {
			animation: n0BD1--rotation 3.5s linear forwards;
			position: absolute;
			top: -120px;
			left: calc(50% - 35px);
			border-radius: 50%;
			border: 5px solid #fff;
			border-top-color: #a29bfe;
			height: 70px;
			width: 70px;
			display: flex;
			justify-content: center;
			align-items: center
		}

		.-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar {
			width: 100%;
			height: 18px;
			background: #dfe6e9;
			border-radius: 5px
		}

		.-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar ._1FVu9--progress-bar {
			height: 100%;
			background: #8bc34a;
			border-radius: 5px
		}

		.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status {
			margin-top: 10px
		}

		.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1XilH--state {
			float: left;
			font-size: .9em;
			letter-spacing: 1pt;
			text-transform: uppercase;
			width: 100px;
			height: 20px;
			position: relative
		}

		.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1jiaj--percentage {
			float: right
		}
	</style>
</head>

<body>

	<h1>Festival: rezervace vstupenek na hudebn√≠ festivaly</h1>

	<dl>
		<dt>Authors</dt>
		<dd>Pavel Yadlouski
			<a href="mailto:xyadlo00@stud.fit.vutbr.cz">xyadlo00@stud.fit.vutbr.cz</a> -
			Backend, database
		</dd>
		<dd>Abramov Mikhail
			<a href="mailto:xabram00@stud.fit.vutbr.cz">xabram00@stud.fit.vutbr.cz</a> -
			Backend, infrastructure
		</dd>
		<dd>Aghayev Raul
			<a href="mailto:xaghay00@stud.fit.vutbr.cz">xaghay00@stud.fit.vutbr.cz</a> -
			Backend, frontend
		</dd>
		<dt>URL aplikace</dt>
		<dd><a href="https://festival-is.herokuapp.com/">https://festival-is.herokuapp.com/</a></dd>
	</dl>

	<h2>System users for testing</h2>
	<p>Enter user for <strong>all existing roles</strong>.</p>
	<table>
		<tbody>
			<tr>
				<th>Login</th>
				<th>Password</th>
				<th>Role</th>
			</tr>
			<tr>
				<td>MainAdmin@ok.com</td>
				<td>!RootAdminSuperSecretKey_qwerty_12345?</td>
				<td>Root administrator</td>
			</tr>
			<tr>
				<td>admin@ok.com</td>
				<td>admin1</td>
				<td>Administrator</td>
			</tr>
			<tr>
				<td>newAdmin@ok.com</td>
				<td>qwert1234</td>
				<td>Administrator</td>
			</tr>
			<tr>
				<td>sem@ok.com</td>
				<td>12341234</td>
				<td>Organizer</td>
			</tr>
			<tr>
				<td>sg@sales.com</td>
				<td>sgsgsg</td>
				<td>Organizer</td>
			</tr>
			<tr>
				<td>seller@ok.com</td>
				<td>seller1</td>
				<td>Seller</td>
			</tr>
			<tr>
				<td>mw@mw.com</td>
				<td>fbm1234</td>
				<td>Basic user</td>
			</tr>
		</tbody>
	</table>

	<h2>Implementation</h2>
	For this project following technologies are used:
	<ul>
		<li><a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a> framework for backend
			<ul>
				<li>Flask Forms - creating web forms</li>
				<li>Flask SQLAlchemy - initialization and manipulations with database (ORM)</li>
				<li>Flask Login - handling user session</li>
			</ul>
		</li>
		<li>HTML + CSS + JS + Bootstrap for frontend</li>
		<li><a href="https://heroku.com">Heroku</a> as hosting platform</li>
		<li>PostgreSQL database extension on Heroku platform</li>
		<li>Docker for PostgreSQL database deployment during local testing</li>
	</ul>

	
	<h3>Database</h3>
	<img src="diagrams/festival-is-DB.svg"/>

	<h3>Role system</h3>
	<p>
		Roles in information system are implemented as inherited classes. 
		Base class is <strong>User</strong>.
		This class inherits from <strong>UserMixin</strong> class 
		(from <a href="https://flask-login.readthedocs.io/en/latest/">flask-login</a> module) and implements basic functionality that is required for handling user session. 
		Also for creating table in database, this class has second inheritance from <strong>SQLAlchemy.Model</strong> class.
	</p>
	<p>
		Class <strong>User</strong> represents normal authorized user.
		For unauthorized users there is class <strong>BaseUser</strong>. 
		This class do not have table in the database. 
		<strong>BaseUser</strong> is needed in order to be able to register ticket for unauthorized user.
	</p>
	<p>
		For <strong>Seller</strong>, <strong>Organizer</strong> and <strong>Admin</strong> roles there are corresponding classes. 
		Inheritance of this classes is represented on database diagram. 
		Each class implements its own functionality and use other methods from the parent class. 
		There is one more role in our information system. 
		Role <strong>RootAdmin</strong> is used as entry point into the system.
		<strong>RootAdmin</strong> is automatically created on initialization of the database. 
		This role has the highest permissions. 
	</p>
	<p>
		This way of role management provides a way to users with higher permissions to have same functionality as lower one. 
		That means that for example <strong>Organizer</strong> role has both organizer (creating festivals, editing festivals owned by him, etc.) and seller functionality (managing ticket for corresponding festival). 
		Similar <strong>Admin</strong> role has as <strong>Organizer</strong>, as <strong>Seller</strong> permissions with additional functionality that corresponds only to administrator role. 
		<strong>RootAdmin</strong> role has all above rights with ability to manage administrators (creating and delete them).
		Also, in case if any organizer or admin with festivals is removed, then	the ownership is transferred to <b>RootAdmin</b>
	</p>

	<h3>Festival manipulations</h3>
	<p>
		From the festival perspective there is width range of functionality.
		As it mas mentioned above, festival can be created by <b>Organizer</b> or other role with higher permissions. 
		When festival is created, ownership is set to current user.
		After creation, festival get status <i>not published</i>.
		This status means, that this festival is still need to be edited and is not present on the main page for all users. 
	</p>
	<p>
		Festival can be published only after adding at list one <b>Performance</b>.
		For creating a performance organizer need to enter music <b>band name</b>, <b>stage ID</b> and <b>time interval</b> for performance.
		Each stage has capacity.
		Maximum capacity of the festival is counted as a sum of stages capacity. 
		So, when stage is deleted, then its capacity is reduces from every festival, that has performance on this stage (and this performance are canceled).
		Same thing happens when for particular festival all performance on given stage are canceled.
	</p>
	<p>
		Obviously, published festival has status <i>published</i> and it is shown on the main page, where every user can reserver ticket on it.
		After publishing, festival can be edited or canceled. 
		Editing of festival include changing festival description, adding sale. 
		Also, on festival edit page seller can be created and added to current festival.
		
	</p>
	
	<h3>Account manipulations</h3>
	<p>
		All users are able to manage their accounts through the page <i>My account</i>.
		They are able to change name, address, email, password, and avatar image.
		Images are stored on AWS S3 bucket.
	</p>

	<h3>Reservations manipulations</h3>
	<h4>Users</h4>
	<p>
		The main opportunity for non-registered and registered users is to create registrations.
	</p>	
	<p>
		Non-registered user can register for any of the available festivals, 
		but cannot has more than three reservations per one uniq email address.
		The email address is required to make a reservation.
		Then the user has the opportunity to sign-in to increase the registration limit
		<mark>or confirm the reservation with the seller.</mark>
	</p>	
	<p>
		Registered user has limitation of six actual reservations for any uniq festival.
		For example to make the seventh reservation for festival N, user has to cancel
		one of previous reservations or pay to seller to approve it.
	</p>
	<p>
		Registered user has ability to observe his or her reservations through the page <i>My tickets</i>
		Here user can control the state of reservation, dates, prices for reservations. 
		An unregistered user who made reservations will have the history of user`s purchases made before registration
	</p>
	<p>
		All upper-level users have these capabilities.
	</p>
	<h4>Sellers</h4>
	<p>
		Sellers are able to manage reservations of the festivals to which they are admitted through the <i>My festivals</i> page.
		Seller is admitted to the festival by owner (organizer) of this festival.
		All upper-level users have these capabilities.
	</p>
	<h4>Organizers</h4>
	<p>
		Organizers are able to manage reservations of their festivals (where they are as owners) or
		festivals to which they are admitted as sellers through the <i>My festivals</i> page.
		All upper-level users have these capabilities.
	</p>
	<h4>Administrators</h4>
	<p>
		Administrators are able to manage tickets through the <i>My festivals</i> page as Organizers or Sellers.
		Otherwise Administrator has additional page <i>Manage festivals</i> where
		he/she is allowed to manage the whole festivals and tickets.
	</p>

	<h2>Extensions</h2>
    <p> 
		<ul>
			<li>Recommendations - festivals that are recommended to a user,  the user will be informed in main page's festival grid</li>
			<li>Sales - in case if some festival has sale, the user will be informed in main page's festival grid</li>
		</ul>

		The recommendations were implemented using "if" statement, in case if customer have ever visited the festival of exact style,
        other festivals with the same style will be counted as recommended, in addition the "RECOMMENDED" line will be appended on a festival picture.
        <br>
        In case of sale, if the festival organizer stated some discount on a festival, the same algorithm will be used, the "SALE" line will be added on 
        picture, additionally the festival's cost will be crossed, and the cost with discount will be showed.</p>
    <h3>Filters</h3>
        <p> The filters were implemented in the way of adding invisible characters to the bottom of each card that were created on the main page.<br>
			The filters are:<br>
				<ul>
                	<li>Festivals with recommendations</li>	
                	<li>Festival with sales</li>
                	<li>Festival's style</li>
                	<li>Festival's cost</li>
					<li>Festival's date</li>
				</ul>
            All of the invisible text are contacting the information about the festivals, whether it is festival's style or festival with recommendation. When filter is added
            the JavaScript function is called and exact function filter the card(by finding the invisible text of the card) according ti filters.<br>

		</p>

	<h2>Installation</h2>
	For hosting we choose Heroku.
	Installation on server goes through following steps:
	<ul>
		<li>Prepare configurations files
			<ul>
				<li>Procfile - specifies how program should be run on Heroku</li>
				<li>requirements.txt - file with required python modules. This file would be used automatically by
					Heroku to install all dependence</li>
				<ul>
					<li>gunicorn==19.7.1</li>
					<li>backcall==0.2.0</li>
					<li>click==7.1.2</li>
					<li>decorator==4.4.2</li>
					<li>Flask==1.1.2</li>
					<li>Flask-SQLAlchemy==2.4.4</li>
					<li>ipython==7.16.1</li>
					<li>ipython-genutils==0.2.0</li>
					<li>itsdangerous==1.1.0</li>
					<li>jedi==0.17.2</li>
					<li>Jinja2==2.11.2</li>
					<li>MarkupSafe==1.1.1</li>
					<li>parso==0.7.1</li>
					<li>pexpect==4.8.0</li>
					<li>pickleshare==0.7.5</li>
					<li>prompt-toolkit==3.0.7</li>
					<li>psycopg2==2.8.6</li>
					<li>ptyprocess==0.6.0</li>
					<li>Pygments==2.6.1</li>
					<li>python-dotenv==0.14.0</li>
					<li>six==1.15.0</li>
					<li>SQLAlchemy==1.3.19</li>
					<li>traitlets==4.3.3</li>
					<li>wcwidth==0.2.5</li>
					<li>Werkzeug==1.0.1</li>
					<li>Flask-WTF==0.14.3</li>
					<li>flask-script==2.0.6</li>
					<li>flask-login==0.5.0</li>
					<li>boto3==1.15.6</li>
				</ul>
				<li>runtime.txt - specifies python version for runtime environment
					<ul>
						<li>python-3.8.5</li>
					</ul>
				</li>

				</ul>
			</li>
			<li>We prepared PostgreSQL database instance on Heroku. To operate with it we prepared manage.py script with
				commands to setup, drop, fill, backup DB.</li>
			<li>To use that script it is important to prepare .env file with nedded variables:
				<ul>
					<li>DATABASE_URL= ***provided in offline documentation*** </li>
					<li>ROOT_EMAIL=MainAdmin@fests.com</li>
					<li>ROOT_PSSWD=!RootAdminSuperSecretKey_qwerty_12345?</li>
				</ul>
			</li>
			<li>Create DB with command `python src/manage.py init_db` </li>
			<li>To import data from prepared csv files use command `python src/manage.py import_db` </li>
			<li>Deploy code with configuration files to Heroku (via heroku CLI or from GitHub). Build of project would
				run automatically. Code include:
				<ul>
					<li>python source code</li>
					<li>HTML templates</li>
					<li>static applets for HTML code</li>
				</ul>
			</li>
			<li>After successful build view build.</li>
		</ul>
		For local tests we used flask framework abilities and local PostgreSQL in Docker.
		Installation goes through following steps:
		<ul>
			<li>Prepare python environment with requirements file:
				<ul>
					<li>requirements.txt - file with required python modules. This file would be used automatically by
						Heroku to install all dependence</li>
				</ul>
			</li>
			<li>To start PostgreSQL DB in Docker run command `docker-compose up -d` (you need to have started docker
				instance) </li>
			<li>After successful deployment of db create .env file needed elements:
				<ul>
					<li>DATABASE_URL=postgres://admin:admin@localhost:5432/festival</li>
					<li>S3_BUCKET=festival-dynamic</li>
					<li>AWS_ACCESS_KEY_ID= ***provided in offline documentation*** </li>
					<li>AWS_SECRET_ACCESS_KEY= ***provided in offline documentation*** </li>
					<li>ROOT_EMAIL=MainAdmin@fests.com</li>
					<li>ROOT_PSSWD=!RootAdminSuperSecretKey_qwerty_12345?</li>
				</ul>
			</li>
			<li>Create DB with command `python src/manage.py init_db` </li>
			<li>To import data from prepared csv files use command `python src/manage.py import_db` </li>
			<li>Start flask with command `python src/festival_is.py`, and open browser on `http://127.0.0.1:5000/` </li>
		</ul>
	</body>

</html>